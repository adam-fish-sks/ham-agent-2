datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// Orders table
model Order {
  id              String   @id
  orderNumber     String   @unique
  poNumber        String?  // Purchase order number from API
  status          String
  orderDate       DateTime
  deliveryDate    DateTime?
  totalAmount     Decimal?
  totalProducts   Int?     // Number of products in order
  currency        String?
  customerId      String?
  employeeId      String?
  warehouseId     String?
  receiver        String?  // Receiver name from API
  receiverType    String?  // employee, office, warehouse
  expressDelivery Boolean  @default(false)
  shippingInfo    Json?    // Complete shipping address as JSON
  notes           String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  employee        Employee? @relation(fields: [employeeId], references: [id])
  warehouse       Warehouse? @relation(fields: [warehouseId], references: [id])
  
  @@map("orders")
}

// Products table
model Product {
  id              String   @id
  name            String
  sku             String?  @unique
  category        String?
  description     String?  @db.Text
  manufacturer    String?
  model           String?
  price           Decimal?
  currency        String?
  status          String?
  stockQuantity   Int?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  assets          Asset[]
  
  @@map("products")
}

// Employees table - PII SCRUBBED
model Employee {
  id                  String   @id
  firstName           String   // Scrubbed: "J***"
  lastName            String   // Scrubbed: "D***"
  email               String   // Scrubbed: "j***@company.com"
  team                String?  // Team name from API
  foreignId           String?  // External system reference
  registrationStatus  String?  // Uninvited, Invited, Registered, etc.
  isDeactivated       Boolean  @default(false)
  userId              String?  // Workwize user account ID
  department          String?  // Department name (simplified from API object)
  role                String?
  status              String?
  jobTitle            String?
  managerId           String?
  officeId            String?
  addressId           String?
  startDate           DateTime?
  endDate             DateTime?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  office              Office?  @relation(fields: [officeId], references: [id])
  address             Address? @relation(fields: [addressId], references: [id])
  assets              Asset[]
  orders              Order[]
  offboards           Offboard[]
  
  @@map("employees")
}

// Assets table - PII SCRUBBED
model Asset {
  id              String   @id
  assetTag        String   @unique
  name            String
  category        String?  // Simplified from API category object
  status          String?
  serialCode      String?  // Matches API: serial_code
  productId       String?
  assignedToId    String?  // Employee ID only, no name
  location        String?  // City/State only, no street address
  purchaseDate    DateTime?
  invoicePrice    Decimal? // Matches API: invoice_price
  invoiceCurrency String?  // Matches API: invoice_currency
  warrantyExpires DateTime?
  notes           String?  @db.Text // Scrubbed: emails/phones/SSNs redacted
  officeId        String?
  warehouseId     String?
  warehouseStatus String?  // available, in_repair, unknown
  condition       String?  // new, used
  tags            Json?    // Array of tag objects from API
  externalReference String? // external_reference from API
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  product         Product? @relation(fields: [productId], references: [id])
  assignedTo      Employee? @relation(fields: [assignedToId], references: [id])
  office          Office?  @relation(fields: [officeId], references: [id])
  warehouse       Warehouse? @relation(fields: [warehouseId], references: [id])
  
  @@map("assets")
}

// Offices table
model Office {
  id              String   @id
  name            String
  code            String?  @unique
  employerId      String?  // Employer/company ID from API
  managerId       String?  // Manager user ID from API
  addressId       String?
  phone           String?
  email           String?
  capacity        Int?
  status          String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  address         Address? @relation(fields: [addressId], references: [id])
  employees       Employee[]
  assets          Asset[]
  
  @@map("offices")
}

// Warehouses table
model Warehouse {
  id                String   @id
  name              String
  code              String?  @unique
  warehouseProvider String?  // logistic_plus, etc.
  addressId         String?
  capacity          Int?
  status            String?
  type              String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  address           Address? @relation(fields: [addressId], references: [id])
  assets            Asset[]
  orders            Order[]
  
  @@map("warehouses")
}

// Addresses table - PII SCRUBBED (no street addresses)
model Address {
  id              String   @id
  city            String?  // Kept
  region          String?  // State/Province - Kept
  country         String?  // Kept
  postalCode      String?  // Optional - may be scrubbed
  latitude        Float?
  longitude       Float?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  offices         Office[]
  warehouses      Warehouse[]
  employees       Employee[]
  
  @@map("addresses")
}

// Countries table
model Country {
  id                String   @id
  name              String
  code              String   @unique
  requiresTin       Boolean  @default(false)
  invoiceCurrency   String?
  isOffboardable    Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("countries")
}

// Offboards table
model Offboard {
  id              String   @id
  employeeId      String
  offboardDate    DateTime
  reason          String?
  status          String?
  returnedAssets  Boolean  @default(false)
  notes           String?  @db.Text
  processedBy     String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  employee        Employee @relation(fields: [employeeId], references: [id])
  
  @@map("offboards")
}
